<!DOCTYPE html>
<!-- packman -->
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>packman</title>
</head>
<body>
    <main>
        <div id="container"></div>
    </main>
    <script>
        /**
         * crée l'application packman
         * @param anchor:string est l'identifiant de l'élément où la fonction injecte l'application packman
         * @param nrRows:number est le nombre de lignes
         * @param nrColumns:number est le nombre de colonnes
         * @param cellSize:number est la taille d'une cellule en pixels
         * @param packmanSize:number est la taille de packman en pixels
         * @return a reference on the application "packman"
         */
        function packmanApp(anchor = 'container', nrRows = 25, nrColumns = 25, cellSize = 21, packmanSize = 17) {
            // récupère une référence sur le div de id "container"
            let container = document.getElementById(anchor);
            // le container doit adapter sa taille à son contenu
            container.style.display = 'inline-block';

            // le damier
            let panel = document.createElement('div');
            // grid layout
            panel.style.display = 'grid';
            // 25 lignes de 21px de hauteur
            panel.style.gridTemplateRows = `repeat(${nrRows}, ${cellSize}px)`;
            // 25 colonnes de 21px de largeur
            panel.style.gridTemplateColumns = `repeat(${nrColumns}, ${cellSize}px)`;
            // un padding de 20px
            panel.style.padding = '20px';
            // couleur de fond noir
            panel.style.backgroundColor = 'black';

            // les cellules
            // pour chacune des 25 lignes
            for (let r = 0; r < nrRows; ++r) {
                // pour chacune des 25 cellules de la ligne
                for (let c = 0; c < nrColumns; ++c) {
                    // crée un élément
                    let cell = document.createElement('div');
                    // mettre en position relative (pour les éléments qui y seront placés)
                    cell.style.position = 'relative';
                    // ajoute lui une bordure
                    cell.style.border = '1px solid purple';
                    // ajoute l'élément au panel
                    panel.appendChild(cell);
                }
            }

            // crée packman
            let packman = document.createElement('div');
            // position absolue (à partir de la cellule parente)
            packman.style.position = 'absolute';
            // largeur
            packman.style.width = packmanSize + 'px';
            // hauteur
            packman.style.height = packman.style.width;
            // couleur
            packman.style.backgroundColor = 'yellow';
            // distance par rapport au sommet (pour centrer packman)
            packman.style.top = ((cellSize - 2 - packmanSize) / 2) + 'px';
            // distance par rapport à la gauche (pour centre packman)
            packman.style.left = packman.style.top;
            // faire un cercle
            packman.style.borderRadius = '50%';
            // ajoute packman à la première cellule
            panel.children[0].appendChild(packman);
            // mémoriser la ligne où se trouve packman
            packman.row = 0;
            // mémoriser la colonne où se trouve packman
            packman.column = 0;
            /**
             * fonction qui fait bouger packman
             * @param deltaRow:number est le déplacement en terme de nombre de lignes
             * @param deltaColumn:number est le déplacement en terme de nombre de colonnes
             */
            packman.move = function (deltaRow = 1, deltaColumn = 1) {
                this.row = addInLimit(this.row, deltaRow, nrRows);
                this.column = addInLimit(this.column, deltaColumn, nrColumns);
                let index = this.row * nrColumns + this.column;
                panel.children[index].appendChild(this);
            }
            // simplified moves
            packman.moveUp = () => packman.move(-1, 0);
            packman.moveDown = () => packman.move(1, 0);
            packman.moveLeft = () => packman.move(0, -1);
            packman.moveRight = () => packman.move(0, 1);


            /**
             */
            function addInLimit(position, delta, limit) {
                position = (position + delta) % limit;
                if (position < 0) position += limit;
                return position;
            }

            // ajoute le damier au container
            container.appendChild(panel);

            return {
                move: (deltaRow, deltaColumn) => packman.move(deltaRow, deltaColumn),
                moveUp: () => packman.moveUp(),
                moveDown: () => packman.moveDown(),
                moveLeft: () => packman.moveLeft(),
                moveRight: () => packman.moveRight()
            }
        }

        let app = packmanApp(undefined, 8, 6);
    </script>
</body>
</html>